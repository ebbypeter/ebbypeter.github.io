<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Create an InfoPath form template to submit data to a SharePoint list. (Part 3 of 4) - How can I do it?</title>
<meta name="description" content="How can I submit data to a SharePoint list from an InfoPath form?">
<meta name="description" content="This walkthrough take us through the steps in creating an InfoPath form to submit data to a SharePoint list.">
<meta name="author" content="Ebby Peter">
<meta name="keywords" content="SharePoint 2010, InfoPath, Walkthrough">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://howcanidoit.in/images/InfoPath-SharePoint-List/step6image5.png">
<meta name="twitter:title" content="Create an InfoPath form template to submit data to a SharePoint list. (Part 3 of 4)">
<meta name="twitter:description" content="This walkthrough take us through the steps in creating an InfoPath form to submit data to a SharePoint list.">
<meta name="twitter:creator" content="@EbbyPeter">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Create an InfoPath form template to submit data to a SharePoint list. (Part 3 of 4)">
<meta property="og:description" content="This walkthrough take us through the steps in creating an InfoPath form to submit data to a SharePoint list.">
<meta property="og:url" content="http://howcanidoit.in/sharepoint/create-an-infopath-form-template-to-submit-data-to-a-sharepoint-list-part-3-of-4">
<meta property="og:site_name" content="How can I do it?">

<meta name="google-site-verification" content="3-GDL4XGJW3KBT2jaHvr0MXkkiaEHd6JTfLSKjPj3gs">
<meta name="msvalidate.01" content="61E4F53D58574CE42FCF77D16F95C06D">


<link rel="canonical" href="http://howcanidoit.in/sharepoint/create-an-infopath-form-template-to-submit-data-to-a-sharepoint-list-part-3-of-4">
<link href="http://howcanidoit.in/feed.xml" type="application/atom+xml" rel="alternate" title="How can I do it? Feed">
<link rel="author" href="https://google.com/+EbbyPeter1?rel=author">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://howcanidoit.in/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://howcanidoit.in/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://howcanidoit.in/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://howcanidoit.in/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://howcanidoit.in/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://howcanidoit.in/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://howcanidoit.in/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://howcanidoit.in/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="http://howcanidoit.in">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="http://howcanidoit.in/images/Ebby.jpg" alt="Ebby Peter photo" class="author-photo">
					<h4>Ebby Peter</h4>
					<p>A developer who specializes in SharePoint, WPF, MVC, Windows 8 and Windows Phone Apps; who loves to experiment and learn something new each day, every day.</p>
				</li>
				<li><a href="http://howcanidoit.in/about/">Learn More</a></li>
				<li>
					<a href="mailto:ebby.learning@outlook.com"><i class="fa fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="http://twitter.com/EbbyPeter"><i class="fa fa-twitter"></i> Twitter</a>
				</li>
				<!--<li>
					<a href="http://facebook.com/EbbyPeter"><i class="fa fa-facebook"></i> Facebook</a>
				</li>
				<li>
					<a href="https://google.com/+EbbyPeter1"><i class="fa fa-google-plus"></i> Google+</a>
				</li>-->
				<li>
					<a href="http://linkedin.com/in/EbbyPeter"><i class="fa fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="http://github.com/EbbyPeter"><i class="fa fa-github"></i> GitHub</a>
				</li>
				
				<!--
				
				-->
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="http://howcanidoit.in/posts/">All Posts</a></li>
				<li><a href="http://howcanidoit.in/tags/">All Tags</a></li>
			</ul>
		</li>
		
	    
	        
	    
	    <li><a href="http://howcanidoit.in/feed.xml" >RSS Feed</a></li>
	  
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->



<div class="entry-header">
    <div class="entry-image">
    <img src="http://howcanidoit.in/images/abstract-11.jpg" alt="Create an InfoPath form template to submit data to a SharePoint list. (Part 3 of 4)">
  </div><!-- /.entry-image -->
</div><!-- /.entry-header -->


<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
          <h2><a href="http://howcanidoit.in">How can I do it?</a></h2>
        
          <h1 class="entry-title"><a href="http://howcanidoit.in/sharepoint/create-an-infopath-form-template-to-submit-data-to-a-sharepoint-list-part-3-of-4" rel="bookmark" title="Create an InfoPath form template to submit data to a SharePoint list. (Part 3 of 4)">Create an InfoPath form template to submit data to a SharePoint list. (Part 3 of 4)</a></h1>
        
        
            <p id="post-description"><i>How can I submit data to a SharePoint list from an InfoPath form?</i></p>
        
        <h2>April 10, 2011</h2>    
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
          Reading time ~8 minutes
        </p><!-- /.entry-reading-time -->
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
        
            <p>This walkthrough take us through the steps in creating an InfoPath form to submit data to a SharePoint list.</p>
        
      <p>The steps on creating the data connections and wiring up of these data connections with the field can be found on my previous blog :</p>

<blockquote>
  <p><a href="http://howcanidoit.in/sharepoint/create-an-infopath-form-template-to-submit-data-to-a-sharepoint-list-part-2-of-4/">Create an InfoPath form template to submit data to a SharePoint list.(Part 2 of 4)</a></p>
</blockquote>

<h1 id="step-6--the-coding--submitting-the-form">Step 6 – The Coding / Submitting the Form</h1>

<p>First step is to choose the language you want to write the code. I prefer C#.</p>

<p>Click on the Language button on the Developer Tab in the InfoPath ribbon, and select the code language and the project location.</p>

<p><a href="http://howcanidoit.in/images/InfoPath-SharePoint-List/step6image1.png"><img src="http://howcanidoit.in/images/InfoPath-SharePoint-List/step6image1.png" alt="Step6Image1" /></a></p>

<p>Click on the <em>Submit Options</em> in the Data Tab.</p>

<p><a href="http://howcanidoit.in/images/InfoPath-SharePoint-List/step6image2.png"><img src="http://howcanidoit.in/images/InfoPath-SharePoint-List/step6image2.png" alt="Step6Image2" /></a></p>

<p>Select <em>Allow users to submit this form</em> checkbox and select <em>Perform custom action using Code</em>. Click on the Edit Code button.</p>

<p><a href="http://howcanidoit.in/images/InfoPath-SharePoint-List/step6image3.png"><img src="http://howcanidoit.in/images/InfoPath-SharePoint-List/step6image3.png" alt="Step6Image3" /></a></p>

<div class="note tip">
  <h5>Tip</h5>
  <p>
    If you get an error mentioning VSTA is not installed (Find the correct error code here), no need to worry. You have not installed VSTA while installing Office 2010. <br />
    To get it installed, Go to Control Panel, Uninstall a program. Select Office 2010 from the list, right click and Select Change. <br />
    In the Microsoft InfoPath section, select <i>Visual Studio Tools for Application</i>, select Run From my Computer, and click Continue.
  </p>
  <p><a href="http://howcanidoit.in/images/InfoPath-SharePoint-List/step6image4.png"><img src="http://howcanidoit.in/images/InfoPath-SharePoint-List/step6image4.png" alt="Step6Image4" /></a></p>
</div>

<p>Before starting, lets add the following references.</p>

<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="n">System</span><span class="p">.</span><span class="n">Core</span>
<span class="n">Microsoft</span><span class="p">.</span><span class="n">mshtml</span>
<span class="n">Microsoft</span><span class="p">.</span><span class="n">SharePoint</span>
<span class="n">Microsoft</span><span class="p">.</span><span class="n">SharePoint</span><span class="p">.</span><span class="n">Client</span>
<span class="n">Microsoft</span><span class="p">.</span><span class="n">SharePoint</span><span class="p">.</span><span class="n">Client</span><span class="p">.</span><span class="n">Runtime</span></code></pre></div>

<p>And add the following import/using statements</p>

<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">using</span> <span class="nn">mshtml</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.SharePoint</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.SharePoint.Client</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span></code></pre></div>

<p>Let us now build a utility function to get the field values from the InfoPath Form.</p>

<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// Gets field values</span>
<span class="c1">/// &lt;/summary&gt; </span>

<span class="c1">/// &lt;param name=&quot;xpath&quot;&gt;&lt;/param&gt;</span>
<span class="c1">/// &lt;returns&gt;&lt;/returns&gt;</span>
<span class="k">private</span> <span class="kt">string</span> <span class="nf">GetValue</span><span class="p">(</span><span class="kt">string</span> <span class="n">xpath</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// return the value of the specified node</span>
    <span class="n">XPathNavigator</span> <span class="n">myNav</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">MainDataSource</span><span class="p">.</span><span class="n">CreateNavigator</span><span class="p">().</span><span class="n">SelectSingleNode</span><span class="p">(</span><span class="n">xpath</span><span class="p">,</span> <span class="n">NamespaceManager</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">myNav</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">?</span> <span class="n">myNav</span><span class="p">.</span><span class="n">Value</span> <span class="p">:</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<p>Now let us build a function to submit data to the SharePoint list.</p>

<p>This can be done using the <code>GetValue()</code> function we just wrote. So code for retrieving data from Title field will be</p>

<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="kt">string</span> <span class="n">title</span> <span class="p">=</span> <span class="n">GetValue</span><span class="p">(</span><span class="s">&quot;/my:myFields/my:Title&quot;</span><span class="p">);</span></code></pre></div>

<p>The XPath value (/my:myFields/my:Title) can be retrieved by right clicking the required field from the Fields window on the right side of the InfoPath window and clicking ‘<em>Copy XPath</em>’ (Last but one option)</p>

<p><a href="http://howcanidoit.in/images/InfoPath-SharePoint-List/step6image5.png"><img src="http://howcanidoit.in/images/InfoPath-SharePoint-List/step6image5.png" alt="Step6Image5" /></a></p>

<p>Repeating the steps for all the fields, we will get a code as follows.</p>

<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// Submits Content to a List</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="k">private</span> <span class="k">void</span> <span class="nf">SubmitToList</span><span class="p">(</span><span class="kt">string</span> <span class="n">listName</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">string</span> <span class="n">title</span> <span class="p">=</span> <span class="n">GetValue</span><span class="p">(</span><span class="s">&quot;/my:myFields/my:Title&quot;</span><span class="p">);</span>
    <span class="kt">string</span> <span class="n">description</span> <span class="p">=</span> <span class="n">GetValue</span><span class="p">(</span><span class="s">&quot;/my:myFields/my:Description&quot;</span><span class="p">);</span>
    <span class="kt">string</span> <span class="n">businessNeed</span> <span class="p">=</span> <span class="n">GetValue</span><span class="p">(</span><span class="s">&quot;/my:myFields/my:BusinessNeed&quot;</span><span class="p">);</span>
    <span class="kt">string</span> <span class="n">businessUnit</span> <span class="p">=</span> <span class="n">GetValue</span><span class="p">(</span><span class="s">&quot;/my:myFields/my:BusinessUnit&quot;</span><span class="p">);</span>
    <span class="kt">string</span> <span class="n">projectType</span> <span class="p">=</span> <span class="n">GetValue</span><span class="p">(</span><span class="s">&quot;/my:myFields/my:ProjectType&quot;</span><span class="p">);</span>
    <span class="kt">string</span> <span class="n">requestedBy</span> <span class="p">=</span> <span class="n">GetValue</span><span class="p">(</span><span class="s">&quot;/my:myFields/my:RequestedBy/pc:Person/pc:AccountId&quot;</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>

<p>We now have the values for the drop down lists. Now we need to get the corresponding data field.</p>

<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="n">XPathNavigator</span> <span class="n">businessUnitNav</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">DataSources</span><span class="p">[</span><span class="s">&quot;BusinessUnits&quot;</span><span class="p">].</span><span class="n">CreateNavigator</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">businessUnit</span><span class="p">))</span> 
    <span class="n">businessUnit</span> <span class="p">=</span> <span class="n">businessUnitNav</span>
        <span class="p">.</span><span class="n">SelectSingleNode</span><span class="p">(</span><span class="s">&quot;/BusinessUnits/BusinessUnit[@Value=&#39;&quot;</span>
        <span class="p">+</span> <span class="n">businessUnit</span> 
        <span class="p">+</span> <span class="s">&quot;&#39;]&quot;</span><span class="p">,</span> 
        <span class="n">NamespaceManager</span><span class="p">).</span><span class="n">GetAttribute</span><span class="p">(</span><span class="s">&quot;Data&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span></code></pre></div>

<p>Repeating the steps for all the dropdown lists, we will get the following code.</p>

<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="n">XPathNavigator</span> <span class="n">businessUnitNav</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">DataSources</span><span class="p">[</span><span class="s">&quot;BusinessUnits&quot;</span><span class="p">].</span><span class="n">CreateNavigator</span><span class="p">();</span>
<span class="n">XPathNavigator</span> <span class="n">projectTypeNav</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">DataSources</span><span class="p">[</span><span class="s">&quot;ProjectType&quot;</span><span class="p">].</span><span class="n">CreateNavigator</span><span class="p">();</span> 

<span class="k">if</span> <span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">businessUnit</span><span class="p">))</span> 
    <span class="n">businessUnit</span> <span class="p">=</span> <span class="n">businessUnitNav</span>
        <span class="p">.</span><span class="n">SelectSingleNode</span><span class="p">(</span><span class="s">&quot;/BusinessUnits/BusinessUnit[@Value=&#39;&quot;</span> 
            <span class="p">+</span> <span class="n">businessUnit</span> <span class="p">+</span> <span class="s">&quot;&#39;]&quot;</span><span class="p">,</span> 
        <span class="n">NamespaceManager</span><span class="p">).</span><span class="n">GetAttribute</span><span class="p">(</span><span class="s">&quot;Data&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
        
<span class="k">if</span> <span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">projectType</span><span class="p">))</span> 
    <span class="n">projectType</span> <span class="p">=</span> <span class="n">projectTypeNav</span>
        <span class="p">.</span><span class="n">SelectSingleNode</span><span class="p">(</span><span class="s">&quot;/ProjectTypes/ProjectType[@Value=&#39;&quot;</span> 
            <span class="p">+</span> <span class="n">projectType</span> <span class="p">+</span> <span class="s">&quot;&#39;]&quot;</span><span class="p">,</span> 
        <span class="n">NamespaceManager</span><span class="p">).</span><span class="n">GetAttribute</span><span class="p">(</span><span class="s">&quot;Data&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span></code></pre></div>

<p>Now we need to add the code to add everything into the SharePoint list. Finally The function will look like this.</p>

<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// Submits Content to a List</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="k">private</span> <span class="k">void</span> <span class="nf">SubmitToList</span><span class="p">(</span><span class="kt">string</span> <span class="n">listName</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">string</span> <span class="n">title</span> <span class="p">=</span> <span class="n">GetValue</span><span class="p">(</span><span class="s">&quot;/my:myFields/my:Title&quot;</span><span class="p">);</span>
	<span class="kt">string</span> <span class="n">description</span> <span class="p">=</span> <span class="n">GetValue</span><span class="p">(</span><span class="s">&quot;/my:myFields/my:Description&quot;</span><span class="p">);</span>
	<span class="kt">string</span> <span class="n">businessNeed</span> <span class="p">=</span> <span class="n">GetValue</span><span class="p">(</span><span class="s">&quot;/my:myFields/my:BusinessNeed&quot;</span><span class="p">);</span>
	<span class="kt">string</span> <span class="n">businessUnit</span> <span class="p">=</span> <span class="n">GetValue</span><span class="p">(</span><span class="s">&quot;/my:myFields/my:BusinessUnit&quot;</span><span class="p">);</span>
	<span class="kt">string</span> <span class="n">projectType</span> <span class="p">=</span> <span class="n">GetValue</span><span class="p">(</span><span class="s">&quot;/my:myFields/my:ProjectType&quot;</span><span class="p">);</span>
	<span class="kt">string</span> <span class="n">requestedBy</span> <span class="p">=</span> <span class="n">GetValue</span><span class="p">(</span><span class="s">&quot;/my:myFields/my:RequestedBy/pc:Person/pc:AccountId&quot;</span><span class="p">);</span> 

	<span class="n">XPathNavigator</span> <span class="n">businessUnitNav</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">DataSources</span><span class="p">[</span><span class="s">&quot;BusinessUnits&quot;</span><span class="p">].</span><span class="n">CreateNavigator</span><span class="p">();</span>
	<span class="n">XPathNavigator</span> <span class="n">projectTypeNav</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">DataSources</span><span class="p">[</span><span class="s">&quot;ProjectType&quot;</span><span class="p">].</span><span class="n">CreateNavigator</span><span class="p">();</span>
	<span class="k">if</span> <span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">businessUnit</span><span class="p">))</span>
		<span class="n">businessUnit</span> <span class="p">=</span> <span class="n">businessUnitNav</span>
			<span class="p">.</span><span class="n">SelectSingleNode</span><span class="p">(</span><span class="s">&quot;/BusinessUnits/BusinessUnit[@Value=&#39;&quot;</span>
				<span class="p">+</span> <span class="n">businessUnit</span> <span class="p">+</span> <span class="s">&quot;&#39;]&quot;</span><span class="p">,</span> 
			<span class="n">NamespaceManager</span><span class="p">).</span><span class="n">GetAttribute</span><span class="p">(</span><span class="s">&quot;Data&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">projectType</span><span class="p">))</span>
		<span class="n">projectType</span> <span class="p">=</span> <span class="n">projectTypeNav</span>
			<span class="p">.</span><span class="n">SelectSingleNode</span><span class="p">(</span><span class="s">&quot;/ProjectTypes/ProjectType[@Value=&#39;&quot;</span> 
				<span class="p">+</span> <span class="n">projectType</span> <span class="p">+</span> <span class="s">&quot;&#39;]&quot;</span><span class="p">,</span> 
			<span class="n">NamespaceManager</span><span class="p">).</span><span class="n">GetAttribute</span><span class="p">(</span><span class="s">&quot;Data&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span>

	<span class="c1">//Adding the values to SharePoint List</span>
	<span class="c1">//This is the SharePoint list data connection we made in InfoPath form.</span>
	<span class="n">SharePointListRWQueryConnection</span> <span class="n">conn</span> <span class="p">=</span> <span class="p">(</span><span class="n">SharePointListRWQueryConnection</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="n">DataConnections</span><span class="p">[</span><span class="s">&quot;Business Requests&quot;</span><span class="p">];</span> 
	<span class="n">Uri</span> <span class="n">siteUri</span> <span class="p">=</span> <span class="n">conn</span><span class="p">.</span><span class="n">SiteUrl</span><span class="p">;</span>

	<span class="n">SPSecurity</span><span class="p">.</span><span class="n">RunWithElevatedPrivileges</span><span class="p">(</span><span class="k">delegate</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="k">using</span> <span class="p">(</span><span class="n">SPSite</span> <span class="n">site</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SPSite</span><span class="p">(</span><span class="n">siteUri</span><span class="p">.</span><span class="n">AbsoluteUri</span><span class="p">))</span>
		<span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">site</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
			<span class="k">using</span> <span class="p">(</span><span class="n">SPWeb</span> <span class="n">web</span> <span class="p">=</span> <span class="n">site</span><span class="p">.</span><span class="n">OpenWeb</span><span class="p">(</span><span class="n">siteUri</span><span class="p">.</span><span class="n">AbsolutePath</span><span class="p">))</span>
			<span class="p">{</span>
				<span class="n">ClientContext</span> <span class="n">clientContext</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ClientContext</span><span class="p">(</span><span class="n">siteUri</span><span class="p">.</span><span class="n">AbsoluteUri</span><span class="p">);</span>
				<span class="n">Web</span> <span class="n">clientweb</span> <span class="p">=</span> <span class="n">clientContext</span><span class="p">.</span><span class="n">Web</span><span class="p">;</span>

				<span class="n">web</span><span class="p">.</span><span class="n">AllowUnsafeUpdates</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

				<span class="n">SPList</span> <span class="n">task</span> <span class="p">=</span> <span class="n">web</span><span class="p">.</span><span class="n">Lists</span><span class="p">[</span><span class="n">listName</span><span class="p">];</span>
				<span class="n">SPListItem</span> <span class="n">item</span> <span class="p">=</span> <span class="n">task</span><span class="p">.</span><span class="n">AddItem</span><span class="p">();</span>
				<span class="n">item</span><span class="p">[</span><span class="s">&quot;Title&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">title</span><span class="p">;</span>
				<span class="n">item</span><span class="p">[</span><span class="s">&quot;Description&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">description</span><span class="p">;</span>
				<span class="n">item</span><span class="p">[</span><span class="s">&quot;Business Need&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">businessNeed</span><span class="p">;</span>
				<span class="n">item</span><span class="p">[</span><span class="s">&quot;Business Unit&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">businessUnit</span><span class="p">;</span>
				<span class="n">item</span><span class="p">[</span><span class="s">&quot;Project Type&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">projectType</span><span class="p">;</span>

				<span class="n">SPFieldUserValueCollection</span> <span class="n">fieldValues</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SPFieldUserValueCollection</span><span class="p">();</span>
				<span class="k">if</span> <span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">requestedBy</span><span class="p">))</span>
				<span class="p">{</span>
					<span class="n">Microsoft</span><span class="p">.</span><span class="n">SharePoint</span><span class="p">.</span><span class="n">Client</span><span class="p">.</span><span class="n">User</span> <span class="n">user</span> <span class="p">=</span> <span class="n">clientweb</span><span class="p">.</span><span class="n">EnsureUser</span><span class="p">(</span><span class="n">requestedBy</span><span class="p">);</span>
					<span class="n">clientContext</span><span class="p">.</span><span class="n">Load</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
					<span class="n">clientContext</span><span class="p">.</span><span class="n">ExecuteQuery</span><span class="p">();</span>

					<span class="n">SPFieldUserValue</span> <span class="n">requestedByValue</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SPFieldUserValue</span><span class="p">(</span><span class="n">web</span><span class="p">,</span> <span class="n">user</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span> <span class="n">user</span><span class="p">.</span><span class="n">LoginName</span><span class="p">);</span>
					<span class="n">fieldValues</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">requestedByValue</span><span class="p">);</span>
					<span class="n">item</span><span class="p">[</span><span class="s">&quot;Requested By&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">fieldValues</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="k">else</span>
				<span class="p">{</span>
					<span class="c1">//If the requested by column is blank, add the user who raised the request as Requested by</span>
					<span class="n">Microsoft</span><span class="p">.</span><span class="n">SharePoint</span><span class="p">.</span><span class="n">Client</span><span class="p">.</span><span class="n">User</span> <span class="n">user</span> <span class="p">=</span> <span class="n">clientweb</span><span class="p">.</span><span class="n">EnsureUser</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">User</span><span class="p">.</span><span class="n">LoginName</span><span class="p">);</span>
					<span class="n">clientContext</span><span class="p">.</span><span class="n">Load</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
					<span class="n">clientContext</span><span class="p">.</span><span class="n">ExecuteQuery</span><span class="p">();</span>
					<span class="n">SPFieldUserValue</span> <span class="n">requestedByValue</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SPFieldUserValue</span><span class="p">(</span><span class="n">web</span><span class="p">,</span> <span class="n">user</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span> <span class="n">user</span><span class="p">.</span><span class="n">LoginName</span><span class="p">);</span>
					<span class="n">fieldValues</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">requestedByValue</span><span class="p">);</span>
					<span class="n">item</span><span class="p">[</span><span class="s">&quot;Requested By&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">fieldValues</span><span class="p">;</span>
				<span class="p">}</span>

				<span class="n">item</span><span class="p">.</span><span class="n">Update</span><span class="p">();</span>

				<span class="n">web</span><span class="p">.</span><span class="n">AllowUnsafeUpdates</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">});</span>
<span class="p">}</span></code></pre></div>

<p>Add the following lines of code to FormEvents_Submit() function.</p>

<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="n">Public</span> <span class="k">void</span> <span class="nf">FormEvents_Submit</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">SubmitEventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// If the submit operation is successful, set</span>
    <span class="c1">// e.CancelableArgs.Cancel = false;</span>
    <span class="c1">// Write your code here.</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="n">e</span><span class="p">.</span><span class="n">CancelableArgs</span><span class="p">.</span><span class="n">Cancel</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="n">SubmitToList</span><span class="p">(</span><span class="s">&quot;Business Requests&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">e</span><span class="p">.</span><span class="n">CancelableArgs</span><span class="p">.</span><span class="n">Cancel</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="n">e</span><span class="p">.</span><span class="n">CancelableArgs</span><span class="p">.</span><span class="n">Message</span> <span class="p">=</span> <span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">;</span>
        <span class="n">e</span><span class="p">.</span><span class="n">CancelableArgs</span><span class="p">.</span><span class="n">MessageDetails</span> <span class="p">=</span> <span class="n">ex</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>Now let us go back to the form and wire up the submit button to submit form. Right click the Submit button, and select properties. On the following dialog box, Select Submit from the action and click apply.</p>

<p><a href="http://howcanidoit.in/images/InfoPath-SharePoint-List/step6image6.png"><img src="http://howcanidoit.in/images/InfoPath-SharePoint-List/step6image6.png" alt="Step6Image6" /></a></p>

<p>Before I forget, we need to change the security level of the InfoPath form. Click File from the ribbon and click Form Options button.</p>

<p>On the Form Options dialog box, click Security and Trust. Unclick Automatically determine security level and select Full Trust.</p>

<p>Click OK.</p>

<p><a href="http://howcanidoit.in/images/InfoPath-SharePoint-List/step6image7.png"><img src="http://howcanidoit.in/images/InfoPath-SharePoint-List/step6image7.png" alt="Step6Image7" /></a></p>

<p>Your InfoPath is ready to be used now. Press F5 on the Visual Studio and you should see the InfoPath working.</p>

<p>On Pressing F5, InfoPath will be launched and we might get a dialog box as below. Click Yes.</p>

<p><a href="http://howcanidoit.in/images/InfoPath-SharePoint-List/step6image8.png"><img src="http://howcanidoit.in/images/InfoPath-SharePoint-List/step6image8.png" alt="Step6Image8" /></a></p>

<p>This is my InfoPath form.</p>

<p><a href="http://howcanidoit.in/images/InfoPath-SharePoint-List/step6image9.png"><img src="http://howcanidoit.in/images/InfoPath-SharePoint-List/step6image9.png" alt="Step6Image9" /></a></p>

<p>The Steps 4 and 5 can be found in my previous blog – <a href="http://howcanidoit.in/sharepoint/create-an-infopath-form-template-to-submit-data-to-a-sharepoint-list-part-2-of-4/">« Create an InfoPath form template to submit data to a SharePoint list.(Part 2 of 4)</a></p>

<p>The next steps can be found in my next blog -<a href="http://howcanidoit.in/sharepoint/create-an-infopath-form-template-to-submit-data-to-a-sharepoint-list-part-4-of-4/"> Create an InfoPath form template to submit data to a SharePoint list.(Part 4 of 4) »</a></p>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="http://howcanidoit.in/tags/#SharePoint 2010" title="Pages tagged SharePoint 2010" class="tag">SharePoint 2010</a><a href="http://howcanidoit.in/tags/#InfoPath" title="Pages tagged InfoPath" class="tag">InfoPath</a><a href="http://howcanidoit.in/tags/#Walkthrough" title="Pages tagged Walkthrough" class="tag">Walkthrough</a></span>
        <span><a href="http://howcanidoit.in/sharepoint/create-an-infopath-form-template-to-submit-data-to-a-sharepoint-list-part-3-of-4" rel="bookmark" title="Create an InfoPath form template to submit data to a SharePoint list. (Part 3 of 4)">Create an InfoPath form template to submit data to a SharePoint list. (Part 3 of 4)</a> was published on <span class="entry-date date published updated"><time datetime="2011-04-10T00:00:00+12:00">April 10, 2011</time></span></span>
        (revised: <span class="entry-date date modified"><time datetime="2014-11-09">November 09, 2014</time></span>)
        <span class="author vcard"><span class="fn"><a href="http://howcanidoit.in/about/" title="About Ebby Peter">Ebby Peter</a></span></span>
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=http://howcanidoit.in/sharepoint/create-an-infopath-form-template-to-submit-data-to-a-sharepoint-list-part-3-of-4" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=http://howcanidoit.in/sharepoint/create-an-infopath-form-template-to-submit-data-to-a-sharepoint-list-part-3-of-4" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=http://howcanidoit.in/sharepoint/create-an-infopath-form-template-to-submit-data-to-a-sharepoint-list-part-3-of-4" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
    <div class="read-more">
  
    <div class="read-more-header">
      <a href="http://howcanidoit.in/sharepoint/create-an-infopath-form-template-to-submit-data-to-a-sharepoint-list-part-2-of-4" class="read-more-btn">Read More</a>
    </div><!-- /.read-more-header -->
    <div class="read-more-content">
      <h3><a href="http://howcanidoit.in/sharepoint/Show-Popups-Programatically-in-SharePoint" title="Show Dialog box / Popups programmatically in SharePoint 2013">Show Dialog box / Popups programmatically in SharePoint 2013</a></h3>
      <p>How can I display a dialog box / popup in SharePoint 2013 programatically? <a href="http://howcanidoit.in/sharepoint/Show-Popups-Programatically-in-SharePoint">Continue reading</a></p>
    </div><!-- /.read-more-content -->
  
  <div class="read-more-list">
    
      <div class="list-item">
        <h4><a href="http://howcanidoit.in/offbeat/my-shiny-new-blog-site" title="My shiny new blog site">My shiny new blog site</a></h4>
        <span>Published on November 10, 2014</span>
      </div><!-- /.list-item -->
    
      <div class="list-item">
        <h4><a href="http://howcanidoit.in/sample/post-template" title="Post Template">Post Template</a></h4>
        <span>Published on November 08, 2014</span>
      </div><!-- /.list-item -->
    
  </div><!-- /.read-more-list -->
</div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2014 <a href="/about/">Ebby Peter</a> | Published under <a href="/license/">MIT License</a> | Powered by <a href="http://jekyllrb.com">Jekyll</a></span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://howcanidoit.in/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://howcanidoit.in/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56540581-1', 'auto');  
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>



    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'ebbypeter'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	        

</body>
</html>
